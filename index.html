<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPA Coffee App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom right, #e3f2fd, #ffffff);
      padding: 20px;
      color: #333;
    }
    .hidden { display: none; }
    .login-section, .cabinet-section, .chat-section { max-width: 800px; margin: 0 auto; }
  </style>
</head>
<body>

  <div id="login" class="login-section">
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
    <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–µ—Ä–≤–∏—Å–æ–º –∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –∫–µ—à–±—ç–∫.</p>

    <div id="g_id_onload"
         data-client_id="634487427489-a3k2nop2pi8ffpprahnchnvbr08djhlp.apps.googleusercontent.com"
         data-context="signin"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false"></div>

    <div class="g_id_signin"
         data-type="standard"
         data-shape="rectangular"
         data-theme="outline"
         data-text="signin_with"
         data-size="large"
         data-logo_alignment="left"></div>

    <button class="btn btn-primary mt-3" id="facebook-login">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Facebook</button>
    <button class="btn btn-dark mt-2" id="apple-login">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Apple ID</button>
    <p class="mt-4 small">–ü—Ä–æ–¥–æ–ª–∂–∞—è, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –Ω–∞—à–µ–π <a href="#">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.</p>
  </div>

  <div id="cabinet" class="cabinet-section hidden">
    <h2 id="username">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –ì–æ—Å—Ç—å!</h2>
    <p class="text-muted">–†–∞–¥—ã —Å–Ω–æ–≤–∞ –≤–∏–¥–µ—Ç—å –≤–∞—Å üòä</p>
    <div class="card">
      <div class="card-body">
        <h4 class="card-title"><i class="bi bi-cash-coin"></i> –í–∞—à –∫–µ—à–±—ç–∫</h4>
        <p class="fs-2">4.75 CAD</p>
        <button class="btn btn-light" onclick="alert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ ‚Äî 10 CAD')">–í—ã–≤–µ—Å—Ç–∏ –∫–µ—à–±—ç–∫</button>
      </div>
    </div>
    <button class="btn btn-danger mt-4" onclick="logout()">–í—ã–π—Ç–∏</button>
  </div>

  <div id="chat" class="chat-section hidden">
    <h3>–ß–∞—Ç</h3>
    <div class="card">
      <div class="card-body">
        <p>–¢—É—Ç –±—É–¥–µ—Ç —á–∞—Ç.</p>
      </div>
    </div>
  </div>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
  <script>
    function showSection(id) {
      document.querySelectorAll('.login-section, .cabinet-section, .chat-section')
        .forEach(el => el.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    function handleCredentialResponse(response) {
      const jwt = response.credential;
      const payload = JSON.parse(atob(jwt.split('.')[1]));
      localStorage.setItem("user", JSON.stringify(payload));
      localStorage.setItem("username", payload.name);
      initApp();
    }

    window.fbAsyncInit = function () {
      FB.init({ appId: '–í–ê–®_FACEBOOK_APP_ID', cookie: true, xfbml: true, version: 'v19.0' });
    };

    document.getElementById("facebook-login").onclick = function () {
      FB.login(function (response) {
        if (response.authResponse) {
          FB.api('/me', { fields: 'name,email,picture' }, function (profile) {
            localStorage.setItem("user", JSON.stringify(profile));
            localStorage.setItem("username", profile.name);
            initApp();
          });
        } else {
          alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Facebook");
        }
      }, { scope: 'public_profile,email' });
    };

    document.getElementById("apple-login").onclick = function () {
      const clientId = '–í–ê–®_APPLE_SERVICE_ID';
      const redirectUri = encodeURIComponent(window.location.href);
      const state = Math.random().toString(36).substring(7);
      const nonce = Math.random().toString(36).substring(7);
      const url = `https://appleid.apple.com/auth/authorize?response_type=code%20id_token&client_id=${clientId}&redirect_uri=${redirectUri}&scope=name%20email&response_mode=fragment&state=${state}&nonce=${nonce}`;
      window.location.href = url;
    };

    function logout() {
      localStorage.clear();
      showSection('login');
    }

    function initApp() {
      const username = localStorage.getItem("username") || '–ì–æ—Å—Ç—å';
      document.getElementById("username").textContent = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${username}!`;
      showSection('cabinet');
    }

    window.onload = function () {
      if (localStorage.getItem("user")) {
        initApp();
      } else {
        showSection('login');
      }
    }
  </script>
</body>
</html>
